<nav class="fixed w-full bg-bg dark:bg-bg shadow-md z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16">
      <!-- Logo -->
      <div class="flex items-center">
        <a href="{{ .Site.Home.RelPermalink }}"
           class="text-3xl font-bold text-text-primary dark:text-text-primary font-heading">
          {{ .Site.Params.name }}
        </a>
      </div>

      <!-- Desktop navigation -->
      <div class="hidden lg:flex items-center space-x-8">
        {{ range .Site.Menus.main }}
          {{ if .HasChildren }}
          <div class="relative group">
            <a href="{{ .URL | relLangURL }}"
               class="nav-link text-text-primary dark:text-text-primary flex items-center">
              {{ .Pre | safeHTML }}{{ .Name }}
              <i class="fas fa-chevron-down ml-2 text-sm"></i>
            </a>
            <div
              class="submenu absolute left-0 top-full mt-2 bg-bg dark:bg-bg shadow-lg rounded-lg z-50 min-w-[10rem] opacity-0 invisible">
              {{ range .Children }}
                <a href="{{ .URL | relLangURL }}"
                   class="nav-link block px-4 py-2 text-sm text-text-primary dark:text-text-primary">
                  {{ .Name }}
                </a>
              {{ end }}
            </div>
          </div>
          {{ else }}
            {{ if hasPrefix .URL "#" }}
            <a href="{{ printf "%s%s" $.Site.Home.RelPermalink .URL }}"
               class="nav-link section-link text-text-primary dark:text-text-primary"
               data-section="{{ .URL }}">
              {{ .Name }}
            </a>
            {{ else }}
            <a href="{{ .URL | relLangURL }}"
               class="nav-link text-text-primary dark:text-text-primary">
              {{ .Name }}
            </a>
            {{ end }}
          {{ end }}
        {{ end }}

        <!-- Language switcher -->
        {{ $homes := $.Site.Home.AllTranslations }}
        {{ if gt (len $homes) 1 }}
        {{ $cur := $.Site.Language.Lang }}
        {{ $currentFlag := "ğŸ³ï¸" }}
        {{ if eq $cur "en" }}{{ $currentFlag = "ğŸ‡¬ğŸ‡§" }}{{ end }}
        {{ if eq $cur "es" }}{{ $currentFlag = "ğŸ‡¨ğŸ‡±" }}{{ end }}
        {{ if eq $cur "fr" }}{{ $currentFlag = "ğŸ‡«ğŸ‡·" }}{{ end }}

        <div class="relative group">
          <a href="#"
             class="nav-link text-text-primary dark:text-text-primary flex items-center"
             aria-label="Language switcher">
            <span class="text-lg mr-1">{{ $currentFlag }}</span>
            <i class="fas fa-chevron-down ml-1 text-sm"></i>
          </a>
          <div
            class="submenu absolute right-0 top-full mt-2 bg-bg dark:bg-bg shadow-lg rounded-lg z-50 min-w-[8rem] opacity-0 invisible">
            {{ range $homes }}
            <a href="{{ .RelPermalink }}"
               class="nav-link block px-4 py-2 text-sm text-text-primary dark:text-text-primary {{ if eq .Language.Lang $.Site.Language.Lang }}font-semibold{{ end }}">
              {{ .Language.LanguageName }}
            </a>
            {{ end }}
          </div>
        </div>
        {{ end }}

        <!-- Social icons -->
        <div class="flex items-center space-x-4" data-animation="social">
          {{ if .Site.Params.linkedin_url }}
          <a href="{{ .Site.Params.linkedin_url }}" target="_blank" rel="noopener noreferrer"
             class="text-text-primary dark:text-text-primary transition-transform duration-300 hover:scale-125">
            <i class="fab fa-linkedin-in text-xl"></i>
          </a>
          {{ end }}
          {{ if .Site.Params.github_url }}
          <a href="{{ .Site.Params.github_url }}" target="_blank" rel="noopener noreferrer"
             class="text-text-primary dark:text-text-primary transition-transform duration-300 hover:scale-125">
            <i class="fab fa-github text-xl"></i>
          </a>
          {{ end }}
        </div>
      </div>

      <!-- Mobile menu button -->
      <div class="lg:hidden flex items-center">
        <button id="menu-btn" class="text-text-primary dark:text-text-primary">
          <i class="fas fa-bars text-2xl"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="hidden lg:hidden bg-bg dark:bg-bg shadow-lg">
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
      {{ range .Site.Menus.main }}
        <a href="{{ .URL | relLangURL }}"
           class="nav-link block px-3 py-2 rounded-md text-base font-medium text-text-primary dark:text-text-primary">
          {{ .Name }}
        </a>
      {{ end }}
    </div>
  </div>

  <!-- Submenu styles -->
  <style>
    .group.open .submenu {
      opacity: 1 !important;
      visibility: visible !important;
    }
  </style>

  <!-- Navigation JS (NO theme logic) -->
  <script>
    // Desktop submenu toggle
    document.querySelectorAll('.group > a.nav-link').forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault();
        const group = this.closest('.group');
        const isOpen = group.classList.contains('open');

        document.querySelectorAll('.group').forEach(g => g.classList.remove('open'));
        if (!isOpen) group.classList.add('open');
      });
    });

    // Close submenus when clicking outside
    document.addEventListener('click', function (event) {
      document.querySelectorAll('.group').forEach(group => {
        if (!group.contains(event.target)) {
          group.classList.remove('open');
        }
      });
    });

    // Mobile menu toggle
    document.getElementById('menu-btn').addEventListener('click', function () {
      document.getElementById('mobile-menu').classList.toggle('hidden');
    });

    // Intelligent section navigation
    document.querySelectorAll('.section-link').forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault();
        const section = this.dataset.section;
        const home = '{{ .Site.Home.RelPermalink }}';

        if (window.location.pathname === home) {
          const el = document.querySelector(section);
          if (el) el.scrollIntoView({ behavior: 'instant', block: 'start' });
        } else {
          window.location.href = home + section;
        }
      });
    });
  </script>
</nav>
