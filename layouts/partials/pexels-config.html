{{/* 
Pexels API Configuration
This partial provides configuration from environment variables (CI/CD) or config.toml fallbacks.
SECURITY NOTE: 
- API keys and endpoints are injected from GitLab CI/CD environment variables
- Fallback to config.toml for local development
- Queries are safe to expose as they're just search terms
*/}}

{{/* Set Pexels queries from Hugo config (safe to expose) */}}
{{ $pexelsQueries := .Site.Params.pexels.queries }}
{{ if not $pexelsQueries }}
  {{ errorf "Pexels queries not configured in config.toml under [params.pexels.queries]" }}
{{ end }}

{{/* Set default hero image from Hugo config */}}
{{ $defaultHeroImage := .Site.Params.default_hero_image | default "/images/hero-default-bg.jpg" }}

{{/* Get Formspree endpoint from environment variable or config fallback */}}
{{ $formspreeEndpoint := getenv "FORMSPREE_ENDPOINT" }}
{{ if not $formspreeEndpoint }}
  {{ $formspreeEndpoint = .Site.Params.formspree_endpoint }}
{{ end }}

{{/* Get Pexels API key from environment variable or config fallback */}}
{{ $pexelsApiKey := getenv "PEXELS_API_KEY" }}
{{ if not $pexelsApiKey }}
  {{ $pexelsApiKey = .Site.Params.pexels_api_key }}
{{ end }}

<div id="pexels-config" 
     data-queries="{{ $pexelsQueries | jsonify }}" 
     data-default-image="{{ $defaultHeroImage }}"
     data-formspree-endpoint="{{ $formspreeEndpoint }}"
     data-pexels-api-key="{{ $pexelsApiKey }}"
     style="display: none;">
</div>

<script>
  // Load configuration from build-time embedded data attributes
  // Values are set during Hugo build from CI/CD environment variables
  
  const configElement = document.getElementById('pexels-config');
  
  if (configElement) {
    // Load Pexels queries
    try {
      window.PEXELS_QUERIES = JSON.parse(configElement.getAttribute('data-queries'));
      console.log('✓ Pexels queries loaded:', window.PEXELS_QUERIES.length, 'queries');
    } catch (error) {
      console.error('Error parsing Pexels queries from config.toml:', error);
      window.PEXELS_QUERIES = [];
    }
    
    // Load default hero image
    window.DEFAULT_HERO_IMAGE = configElement.getAttribute('data-default-image');
    console.log('✓ Default hero image:', window.DEFAULT_HERO_IMAGE);
    
    // Load Formspree endpoint
    window.FORMSPREE_ENDPOINT = configElement.getAttribute('data-formspree-endpoint');
    if (window.FORMSPREE_ENDPOINT) {
      console.log('✅ Formspree endpoint configured');
    } else {
      console.warn('⚠️ Formspree endpoint not configured');
    }
    
    // Load Pexels API key (optional)
    window.PEXELS_API_KEY = configElement.getAttribute('data-pexels-api-key');
    if (window.PEXELS_API_KEY) {
      console.log('✅ Pexels API key configured');
    } else {
      console.log('ℹ️ No Pexels API key - using default image');
    }
  } else {
    console.error('Pexels config element not found');
    window.PEXELS_QUERIES = [];
    window.DEFAULT_HERO_IMAGE = '/images/hero-default-bg.jpg';
    window.FORMSPREE_ENDPOINT = null;
    window.PEXELS_API_KEY = null;
  }
</script>
